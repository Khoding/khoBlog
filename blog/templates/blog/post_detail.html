{% extends 'blog/base_post_main_block.html' %}
{% load static %}
{% load markdown_extra %}

{% block page_top_title %}
    <h2>{{ title }}
        <div class="btn-group float-right" role="group" aria-label="Previous / Next">
            <a class="btn btn-primary" href="{{ post.get_previous_by_created_date.get_absolute_url }}">
                <span class="iconify" data-icon="topcoat:back" data-inline="false"></span>
            </a>

            <a class="btn btn-primary" href="{{ post.get_next_by_created_date.get_absolute_url }}">
                <span class="iconify" data-icon="topcoat:next" data-inline="false"></span>
            </a>
        </div>
    </h2>
{% endblock page_top_title %}

{% block content_main %}

    {% if post.published_date and not post.private and not post.published_date > now or not post.published_date and user.is_superuser or post.private and user.is_superuser or post.published_date > now and user.is_superuser %}

        <div class="card text-white border-secondary bg-dark mb-3">
            <div class="card-header border-secondary">
                <h2>Post #{{ post.id }} {% include 'blog/superbuttons.html' %}</h2>
            </div>

            <div class="card-body">
                <h2 class="card-title">{{ post.title }}</h2>
                <div class="blog-post-meta">
                    {% include 'blog/postdates.html' %}
                </div>
                <span class="card-text">{{ post.body|formatted_markdown|safe }}</span>
            </div>

            <div id="comments" class="card-footer border-secondary">
                <div class="d-flex col-12 col-lg-5 p-0">
                    <button type="button" class="btn btn-primary w-100" data-toggle="modal"
                        data-target="#commentModal-{{ post.id }}">Add Comment
                    </button>

                    <div class="modal fade" id="commentModal-{{ post.id }}" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content bg-dark">
                                <ul class="nav nav-tabs" id="commentModalTab-{{ post.id }}" role="tablist">

                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link active" id="comments-tab-{{ post.id }}" data-toggle="tab" href="#comments-{{ post.id }}"
                                        role="tab" aria-controls="comments" aria-selected="true">Add Comment</a>
                                    </li>
                                </ul>

                                <div class="tab-content" id="commentModalContent-{{ post.id }}">

                                    <div class="tab-pane fade show active" id="comments-{{ post.id }}" role="tabpanel"
                                        aria-labelledby="comments-tab-{{ post.id }}">

                                        <div class="modal-header">
                                            <h5 class="modal-title">{{ post.title }} - #{{ post.id }} - Add Comment</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true" class="text-light">&times;</span>
                                            </button>
                                        </div>

                                        <div class="modal-body">
                                            {% include 'blog/add_comment_to_post.html' %}
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            <a href="{{ post.get_absolute_url }}#comments" class="btn btn-primary">Continue Reading</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% include 'blog/postcomments.html' %}
            </div>

        </div>

    {% else %}
        <h1><a class="btn btn-danger" href="/pages/kheee">This post is either private or still a draft, you must be logged in
            to be able to see it</a></h1>
    {% endif %}
{% endblock content_main %}

{% block pagination %}
{% endblock pagination %}
